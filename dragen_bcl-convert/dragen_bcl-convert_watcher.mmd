---
config:
  theme: mc
  look: classic
  layout: dagre
---
flowchart TB
    A[fa:fa-flag Start: Scan WATCHDIRS for runs] --> B{Is folder name valid?}
    B -->|No| C[fa:fa-ban PASS: Ignore folder]
    B -->|Yes| D{CopyComplete.txt exists?}
    D -->|No| E[fa:fa-ban PASS: Sequencing not finished]
    D -->|Yes| F{FastqComplete.txt exists?}
    F -->|Yes| G[fa:fa-ban PASS: Run already processed]
    F -->|No| H{DemuxFailed.txt or failed.txt exists?}
    H -->|Yes| I[fa:fa-ban PASS: Run marked as failed]
    H -->|No| J{DemuxStarted.txt exists?}
    J -->|Yes| K[fa:fa-ban PASS: Demux in progress]
    J -->|No| L{LowPass.csv exists?}
    L -->|Yes| M[fa:fa-ban PASS: LowPass SampleSheet found]
    L -->|No| N{SampleSheet.csv exists?}
    N -->|No| O[Fetch SampleSheet using get_nanuq_files.py]
    O --> P[Convert SampleSheet to Unix format]
    P --> Q[Launch dragen_bcl-convert_launcher.sh]
    N -->|Yes| R{SampleSheet contains LowPass or Cloud_Workflow?}
    R -->|Yes| S[fa:fa-ban PASS: LowPass or Cloud_Workflow SampleSheet]
    R -->|No| Q
    Q --> T[Wait for FastqComplete.txt]
    T --> U[Gather demultiplexing stats]
    U --> V[Run cp_RunInfo_Stats.sh]
    V --> W[Run qc_demultiplex_stats.py]
    C & E & G & I & K & M & S --> X[Continue scanning other folders]
    W --> X